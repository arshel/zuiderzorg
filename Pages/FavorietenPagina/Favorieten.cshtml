@page
@model FavorietenModel

<head>
    <link href="~/css/FavouriteStyle.css" rel="stylesheet"/>
</head>

<body style="background-color:#E9E2E2;">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <div class="row">
        <div class="col">
            <div class="button1">
                <button class="Back" onclick="GoBack()"> <img src="/images/CatagoryIcons/BackIcon.png" height=100 width=100 /><br /> <strong>Terug</strong></button>
            </div>
            <div class="button2">
                <button class="Help" onclick="JavaScript:alert('This button is under construction, please remain calm.')">  <img src="/images/CatagoryIcons/InfoIcon.png" height=150 width=150 /><br /> <strong>Vraag om hulp</strong></button>
            </div>
        </div>
        <div class="col-7">
            <div class="NoFavourites">
                <h1 class="NoFavouritesText">U heeft nog geen favorieten</h1>
                <h3 class="NoFavouritesText2">Voeg eerst een product toe aan favorieten</h3>
                <button class="NoFavouritesButton" onclick="ToCatagoryPage()">Naar categorie pagina</button>
            </div>
                <div id="nav-Favorieten">
                </div>
        </div>
        <div class="col-md">
            <div id="stars">
            </div>
            <button class="Arrow" id="upArrow" value="false" onclick="scrolling(value)"><i class="bi bi-arrow-up-square-fill" style="font-size:4vw;color:#6CBF2A;position:relative;"></i> <br /> <strong>Naar boven</strong></button>
            <button class="Arrow" id="downArrow" value="true" onclick="scrolling(value)"><i class="bi bi-arrow-down-square-fill" style="font-size:4vw;color:#6CBF2A;position:relative;"></i> <br /> <strong>Naar beneden</strong></button>
        </div>
        <div class="modal fade" id="Popup" tabindex="-1" aria-labelledby="LeavePopup" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title deletetitle" id="exampleModalLabel"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Als u op "Doorgaan" klikt wordt het product uit favorieten verwijderd. Als u dit niet wilt kunt u op "Terug" drukken.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Terug</button>
                        <button type="button" class="btn btn-primary" onclick="Delete()">Doorgaan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


<script>
    // Variable that needs to be used outside of just a single function.
    var starstring = {};
    // Checks the position for the need of the up and down arrows.
    window.onscroll = function() {PositionCheck()};

    function PositionCheck() {
        if (document.documentElement.scrollTop == 0) {
            document.getElementsByClassName("Arrow")[0].style.visibility = "hidden";
        } else {
            document.getElementsByClassName("Arrow")[0].style.visibility = "visible";
        }

        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
            document.getElementsByClassName("Arrow")[1].style.visibility = "hidden";
        } else {
            document.getElementsByClassName("Arrow")[1].style.visibility = "visible";
        }
    }
    // Function for scrolling.
    function scrolling(n) {
        var scrolloffset = $(window).height();
        scrolloffset *= 0.87;
        var top = document.documentElement.scrollTop || document.body.scrollTop;
        if (n == "true") {
            var newscroll = top + scrolloffset;
        } else {
            var newscroll = top - scrolloffset;
        }
        window.scrollTo({ top: newscroll, behavior: 'smooth' })
    }

    // Function to delete a product out of favourites.
    function ToDelete(number) {
        starstring = "";
        starstring = "FAVOURITEDPRODUCT:" + number;
        
        productstring = "";
        productstring = JSON.parse(localStorage.getItem(starstring)).name;
        document.getElementsByClassName("deletetitle")[0].innerHTML = "Wilt u " + "'" + productstring + "'" + " uit favorieten verwijderen?"
    }

    // Function to delete the product out of favourites.
    function Delete() {
        localStorage.removeItem(starstring);
        location.reload();
        ArrowCheck();
    }

    // Function to go to the Catagory Page.
    function ToCatagoryPage() {
        location.href = "http://localhost:5090/nl/product_select_page";
    }

    // Function to check if the arrows are neccesary.
    function ArrowCheck() {
        // Only make the up and down arrows appear if there are more than 3 products
        productAmount = $('.ProductBlock').length;
        if (productAmount > 3) {
            document.getElementsByClassName("Arrow")[0].style.visibility = "visible";
            document.getElementsByClassName("Arrow")[1].style.visibility = "visible";
        }
    }

    // Onload function. Check if there are products in favourites.
    window.onload = function () {
        var values = [];
        keys = Object.keys(localStorage);

        for (var i = 0; i < keys.length; i++) {
            if (keys[i].indexOf("FAVOURITEDPRODUCT:") != -1) {
                values.push(JSON.parse(localStorage.getItem(keys[i])))
            }
        }

        if (values.length == 0) {
            var NoFav = document.getElementsByClassName("NoFavourites");
            NoFav[0].style.visibility = "visible";
        } else {
            values.forEach(ProductShow);
        }
        ArrowCheck();
        PositionCheck();
    };

    // Function to show the correct products.
    function ProductShow(object) {
        var makeProduct = 
        `<button type="button" class="ProductBlock" id="nav ProductBlock${object.GUIDfield}" value="${object.GUIDfield}" onclick="ToProduct(value)" data-toggle="tooltip" data-popper-placement="top" title="Placeholder">${object.name}
            <div class="PriceBlock">${object.price}</div>
            <div class="imagefield">
                <img class="image" src="https://www.wibra.nl/wp-content/uploads/sites/3/2022/02/17570058-000-01.png" alt="BlikopenerFoto">
            </div>
        </button>`;

        var makeStar = 
        `<button class="star" id="star${object.GUIDfield}" value=${object.GUIDfield} onclick="ToDelete(value)" data-bs-toggle="modal" data-bs-target="#Popup">
            <i class="bi bi-star-fill" style="font-size:10vh;color:#6CBF2A;position:relative;top:-15%;"></i>
        </button>`;

        document.getElementById("nav-Favorieten").innerHTML += makeProduct;

        document.getElementById("stars").innerHTML += makeStar;

    }

    // Function to go back.
    function GoBack() {
        // If the page is accessed via the url the user will be send back to the home screen, otherwise the user will go back to the previous page
        if (localStorage.getItem("location") != null) {
            var newLocation = localStorage.getItem("location");
        } else {
            var newLocation = "http://localhost:5090";
        }
        localStorage.removeItem("location");
        location.href = newLocation;
    }

    // Function to go to the right product.
    function ToProduct(id) {
        document.cookie = "ProductId=" + id + ";path=/;";
        location.href = "/productpagina/product";
    }
</script>
